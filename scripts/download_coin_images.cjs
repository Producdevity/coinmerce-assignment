const https = require('https')
const fs = require('fs')
const path = require('path')

const coins = [
  'AAVE',
  'ACA',
  'ACH',
  'ACM',
  'ADA',
  'ADX',
  'AGIX',
  'AGLD',
  'AKRO',
  'ALGO',
  'ALICE',
  'ALPACA',
  'ALPHA',
  'ALPINE',
  'AMB',
  'AMP',
  'ANKR',
  'ANT',
  'APE',
  'API3',
  'APT',
  'AR',
  'ARB',
  'ARDR',
  'ARK',
  'ASR',
  'AST',
  'ASTR',
  'ATM',
  'ATOM',
  'AUDIO',
  'AVA',
  'AVAX',
  'AXS',
  'BADGER',
  'BAKE',
  'BAL',
  'BAND',
  'BAR',
  'BAT',
  'BCH',
  'BCNA',
  'BEL',
  'BETA',
  'BETH',
  'BICO',
  'BIFI',
  'BLOK',
  'BLZ',
  'BNB',
  'BNT',
  'BOND',
  'BSW',
  'BTC',
  'BTS',
  'BTTC',
  'BUSD',
  'C98',
  'CAKE',
  'CELO',
  'CELR',
  'CFX',
  'CHESS',
  'CHR',
  'CHZ',
  'CITY',
  'CKB',
  'CLV',
  'COMBO',
  'COMP',
  'COS',
  'COTI',
  'CREAM',
  'CRO',
  'CRV',
  'CTK',
  'CTSI',
  'CVC',
  'CVX',
  'CYBER',
  'DAR',
  'DATA',
  'DCR',
  'DEGO',
  'DENT',
  'DEXE',
  'DF',
  'DGB',
  'DIA',
  'DOCK',
  'DODO',
  'DOGE',
  'DOT',
  'DREP',
  'DUSK',
  'DYDX',
  'EDU',
  'EGLD',
  'ELF',
  'ENJ',
  'ENS',
  'EOS',
  'ERN',
  'ETC',
  'ETH',
  'EWT',
  'FARM',
  'FET',
  'FIDA',
  'FIL',
  'FIO',
  'FITFI',
  'FLM',
  'FLOKI',
  'FLOW',
  'FLR',
  'FLUX',
  'FOR',
  'FORTH',
  'FRONT',
  'FTM',
  'FTT',
  'FUN',
  'FXS',
  'GAL',
  'GALA',
  'GFT',
  'GHST',
  'GLM',
  'GLMR',
  'GMT',
  'GNO',
  'GNS',
  'GRT',
  'GST',
  'GTC',
  'HARD',
  'HBAR',
  'HFT',
  'HIFI',
  'HIGH',
  'HIVE',
  'HNT',
  'HOOK',
  'HOT',
  'ICP',
  'ICX',
  'ID',
  'IDEX',
  'ILV',
  'IMX',
  'INJ',
  'IOST',
  'IOTA',
  'IOTX',
  'IQ',
  'IRIS',
  'JASMY',
  'JOE',
  'JST',
  'JUV',
  'KAVA',
  'KCS',
  'KDA',
  'KEY',
  'KLAY',
  'KMD',
  'KNC',
  'KP3R',
  'KSM',
  'LAZIO',
  'LDO',
  'LEVER',
  'LINA',
  'LINK',
  'LIT',
  'LMWR',
  'LOKA',
  'LOOM',
  'LPT',
  'LQTY',
  'LRC',
  'LSK',
  'LTC',
  'LTO',
  'LUNA',
  'LUNC',
  'MAGIC',
  'MANA',
  'MASK',
  'MATIC',
  'MAV',
  'MBL',
  'MBOX',
  'MC',
  'MDT',
  'MINA',
  'MKR',
  'MLN',
  'MOVR',
  'MTL',
  'MULTI',
  'NEAR',
  'NEO',
  'NEXO',
  'NKN',
  'NMR',
  'NULS',
  'OAX',
  'OCEAN',
  'OG',
  'OGN',
  'OMG',
  'ONE',
  'ONEINCH',
  'ONG',
  'ONT',
  'OP',
  'ORN',
  'OSMO',
  'OXT',
  'PEPE',
  'PERL',
  'PERP',
  'PLA',
  'PNT',
  'POLS',
  'POLYX',
  'POND',
  'PORTO',
  'POWR',
  'PROM',
  'PROPC',
  'PROS',
  'PSG',
  'PUNDIX',
  'PYR',
  'QI',
  'QKC',
  'QNT',
  'QTUM',
  'RARE',
  'RDNT',
  'REEF',
  'REI',
  'REN',
  'REQ',
  'RLC',
  'RNDR',
  'ROSE',
  'RPL',
  'RSR',
  'RUNE',
  'RVN',
  'SAND',
  'SANTOS',
  'SC',
  'SCRT',
  'SEI',
  'SFP',
  'SHIB',
  'SKL',
  'SLP',
  'SNT',
  'SNX',
  'SOL',
  'SPELL',
  'SRM',
  'SSV',
  'STEEM',
  'STG',
  'STMX',
  'STORJ',
  'STPT',
  'STRAX',
  'STX',
  'SUI',
  'SUSHI',
  'SXP',
  'SYN',
  'SYS',
  'T',
  'TEL',
  'TFUEL',
  'THETA',
  'TKO',
  'TLM',
  'TOMO',
  'TRB',
  'TROY',
  'TRX',
  'TUSD',
  'TVK',
  'TWT',
  'UFT',
  'UMA',
  'UNFI',
  'UNI',
  'USDC',
  'USDP',
  'USDT',
  'UTK',
  'VET',
  'VGX',
  'VIB',
  'VIDT',
  'VITE',
  'VOXEL',
  'VRA',
  'VTHO',
  'WAN',
  'WAVES',
  'WAXP',
  'WBETH',
  'WBTC',
  'WIN',
  'WING',
  'WOO',
  'WRX',
  'WTC',
  'XDC',
  'XEM',
  'XLM',
  'XNO',
  'XRP',
  'XTZ',
  'XVS',
  'YFI',
  'YGG',
  'ZEN',
  'ZIL',
  'ZRX',
]

/**
 * A size constant.
 * @const {number}
 * @default 30
 * @description Can be either 30 or 44.
 */
const size = 30

const outputDir = path.join(__dirname, `public/images/coins/${size}x${size}`)

if (!fs.existsSync(outputDir)) {
  fs.mkdirSync(outputDir, { recursive: true })
}

const downloadImage = (url, callback) => {
  const outputFilename = path.join(__dirname, path.basename(url))
  const fileStream = fs.createWriteStream(outputFilename)

  https
    .get(url, (response) => {
      response.pipe(fileStream)

      fileStream.on('finish', () => {
        fileStream.close(callback) // close the stream and call callback
      })
    })
    .on('error', (err) => {
      fs.unlink(outputFilename) // Delete the file on error
      console.error(`Error downloading ${url}: ${err.message}`)
      callback(err) // Call the callback with error
    })
}

const downloadAllImages = () => {
  let currentIndex = 0

  const next = () => {
    if (currentIndex >= coins.length) {
      console.log('Finished downloading all images.')
      return
    }

    const coin = coins[currentIndex]
    const coinImageUrl = `https://coinmerce.io/assets/images/icons/coins/44x44/${coin}.png`
    currentIndex++

    downloadImage(coinImageUrl, (err) => {
      if (!err) {
        console.log(`Downloaded ${coinImageUrl}`)
      }
      next() // Proceed to next image
    })
  }

  next() // Start the download chain
}

downloadAllImages()
